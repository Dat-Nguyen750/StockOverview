{% extends "base.html" %}

{% block title %}API Documentation - Stock Evaluator Pro{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="text-center mb-4">
            <h2 class="fw-bold text-dark">
                <i class="fas fa-book text-primary me-2"></i>
                API Documentation
            </h2>
            <p class="text-muted">
                Integrate Stock Evaluator Pro into your applications
            </p>
        </div>

        <!-- Overview -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Overview
                </h5>
            </div>
            <div class="card-body">
                <p>
                    The Stock Evaluator Pro API allows you to programmatically evaluate stocks 
                    using your own API keys. All evaluations are performed using your credentials 
                    for complete privacy and control.
                </p>
                <div class="alert alert-info">
                    <strong>Base URL:</strong> <code>{{ request.url_root.rstrip('/') }}</code>
                </div>
            </div>
        </div>

        <!-- Authentication -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-key me-2"></i>
                    Authentication
                </h5>
            </div>
            <div class="card-body">
                <p>
                    You need to provide your own API keys for the following services:
                </p>
                <ul>
                    <li><strong>Financial Modeling Prep:</strong> For financial data and ratios</li>
                    <li><strong>SERP API:</strong> For news sentiment and market analysis</li>
                    <li><strong>Google Gemini:</strong> For AI-powered business insights</li>
                </ul>
                <p class="text-muted">
                    Your API keys are used only for the specific request and are never stored.
                </p>
            </div>
        </div>

        <!-- API Endpoints -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-code me-2"></i>
                    API Endpoints
                </h5>
            </div>
            <div class="card-body">
                <!-- Evaluate Endpoint -->
                <div class="mb-4">
                    <h6 class="fw-bold text-primary">POST /api/evaluate</h6>
                    <p class="text-muted">Evaluate a stock for investment potential</p>
                    
                    <h6>Request Body:</h6>
                    <pre><code>{
  "ticker": "AAPL",
  "fmp_api_key": "your_fmp_api_key",
  "serp_api_key": "your_serp_api_key", 
  "gemini_api_key": "your_gemini_api_key",
  "include_detailed_analysis": true
}</code></pre>
                    
                    <h6>Response:</h6>
                    <pre><code>{
  "ticker": "AAPL",
  "company_name": "Apple Inc.",
  "score_breakdown": {
    "financial_health": 84,
    "business_fundamentals": 78,
    "valuation": 70,
    "growth_potential": 76,
    "sentiment": 68
  },
  "composite_score": 75.6,
  "verdict": "âœ… Investable",
  "explanation": "Strong performance in financial health...",
  "evaluation_timestamp": "2024-01-15T10:30:00",
  "data_sources": ["Financial Modeling Prep", "Google Gemini", "SERP API"]
}</code></pre>
                </div>

                <!-- Health Endpoint -->
                <div class="mb-4">
                    <h6 class="fw-bold text-primary">GET /health</h6>
                    <p class="text-muted">Check API health status</p>
                    
                    <h6>Response:</h6>
                    <pre><code>{
  "status": "healthy",
  "api": "connected"
}</code></pre>
                </div>
            </div>
        </div>

        <!-- Code Examples -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-laptop-code me-2"></i>
                    Code Examples
                </h5>
            </div>
            <div class="card-body">
                <!-- Python Example -->
                <div class="mb-4">
                    <h6 class="fw-bold">Python</h6>
                    <pre><code>import requests

url = "{{ request.url_root.rstrip('/') }}/api/evaluate"
data = {
    "ticker": "AAPL",
    "fmp_api_key": "your_fmp_api_key",
    "serp_api_key": "your_serp_api_key",
    "gemini_api_key": "your_gemini_api_key",
    "include_detailed_analysis": True
}

response = requests.post(url, json=data)
result = response.json()

print(f"Score: {result['composite_score']}/100")
print(f"Verdict: {result['verdict']}")</code></pre>
                </div>

                <!-- JavaScript Example -->
                <div class="mb-4">
                    <h6 class="fw-bold">JavaScript</h6>
                    <pre><code>const url = "{{ request.url_root.rstrip('/') }}/api/evaluate";
const data = {
    ticker: "AAPL",
    fmp_api_key: "your_fmp_api_key",
    serp_api_key: "your_serp_api_key",
    gemini_api_key: "your_gemini_api_key",
    include_detailed_analysis: true
};

fetch(url, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify(data)
})
.then(response => response.json())
.then(result => {
    console.log(`Score: ${result.composite_score}/100`);
    console.log(`Verdict: ${result.verdict}`);
});</code></pre>
                </div>

                <!-- cURL Example -->
                <div class="mb-4">
                    <h6 class="fw-bold">cURL</h6>
                    <pre><code>curl -X POST "{{ request.url_root.rstrip('/') }}/api/evaluate" \
  -H "Content-Type: application/json" \
  -d '{
    "ticker": "AAPL",
    "fmp_api_key": "your_fmp_api_key",
    "serp_api_key": "your_serp_api_key",
    "gemini_api_key": "your_gemini_api_key",
    "include_detailed_analysis": true
  }'</code></pre>
                </div>
            </div>
        </div>

        <!-- Error Handling -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Error Handling
                </h5>
            </div>
            <div class="card-body">
                <p>All errors return appropriate HTTP status codes and error messages:</p>
                
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Status Code</th>
                                <th>Description</th>
                                <th>Example Response</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-danger">400</span></td>
                                <td>Bad Request - Missing or invalid parameters</td>
                                <td><code>{"error": "Ticker symbol is required"}</code></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-danger">500</span></td>
                                <td>Internal Server Error</td>
                                <td><code>{"error": "API Error"}</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Rate Limits -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-tachometer-alt me-2"></i>
                    Rate Limits
                </h5>
            </div>
            <div class="card-body">
                <p>
                    Rate limits are based on your individual API key limits:
                </p>
                <ul>
                    <li><strong>Financial Modeling Prep:</strong> 15 requests/minute (free tier)</li>
                    <li><strong>SERP API:</strong> Varies by plan</li>
                    <li><strong>Google Gemini:</strong> Varies by plan</li>
                </ul>
                <div class="alert alert-warning">
                    <i class="fas fa-info-circle me-2"></i>
                    Analysis typically takes 30-60 seconds due to multiple API calls.
                </div>
            </div>
        </div>

        <!-- Support -->
        <div class="text-center">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="mb-3">
                        <i class="fas fa-question-circle text-primary me-2"></i>
                        Need Help?
                    </h5>
                    <p class="mb-3">
                        If you need assistance with the API or have questions about integration, 
                        please check our documentation or contact support.
                    </p>
                    <a href="{{ url_for('about') }}" class="btn btn-primary me-2">
                        <i class="fas fa-info-circle me-2"></i>
                        About
                    </a>
                    <a href="{{ url_for('evaluate') }}" class="btn btn-outline-primary">
                        <i class="fas fa-play me-2"></i>
                        Try It Now
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 