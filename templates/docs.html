{% extends "base.html" %}

{% block title %}API Documentation - StockOverview{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <!-- Header -->
        <div class="text-center mb-4">
            <h2 class="fw-bold text-dark">
                <i class="fas fa-book text-primary me-2"></i>
                API Documentation
            </h2>
            <p class="text-muted">
                Programmatic access to StockOverview's stock analysis capabilities
            </p>
        </div>

        <!-- API Overview -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    API Overview
                </h5>
            </div>
            <div class="card-body">
                <p>
                    StockOverview provides a RESTful API for programmatic stock analysis. 
                    You can integrate our analysis capabilities into your own applications.
                </p>
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary">Base URL</h6>
                        <code>https://your-app-domain.com/api</code>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary">Rate Limit</h6>
                        <code>5 requests per minute per IP</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Authentication -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-key me-2"></i>
                    Authentication
                </h5>
            </div>
            <div class="card-body">
                <p>
                    API keys are passed in the request headers. You need to provide your own API keys for:
                </p>
                <ul>
                    <li><strong>Financial Modeling Prep:</strong> <code>X-FMP-API-Key</code></li>
                    <li><strong>SERP API:</strong> <code>X-SERP-API-Key</code></li>
                    <li><strong>Google Gemini:</strong> <code>X-GEMINI-API-Key</code></li>
                </ul>
            </div>
        </div>

        <!-- Endpoints -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-code me-2"></i>
                    API Endpoints
                </h5>
            </div>
            <div class="card-body">
                <!-- Evaluate Endpoint -->
                <div class="mb-4">
                    <h6 class="text-primary">POST /api/evaluate</h6>
                    <p class="text-muted">Analyze a stock and get comprehensive evaluation results.</p>
                    
                    <h6>Request Body:</h6>
                    <pre><code>{
  "ticker": "AAPL",
  "fmp_api_key": "your_fmp_api_key",
  "serp_api_key": "your_serp_api_key", 
  "gemini_api_key": "your_gemini_api_key",
  "include_detailed_analysis": true
}</code></pre>
                    
                    <h6>Response:</h6>
                    <pre><code>{
  "ticker": "AAPL",
  "company_name": "Apple Inc.",
  "composite_score": 85.5,
  "verdict": "âœ… Investable",
  "score_breakdown": {
    "financial_health": 82,
    "valuation": 78,
    "growth_potential": 88,
    "market_sentiment": 85,
    "risk_assessment": 80
  },
  "explanation": "Apple shows strong fundamentals...",
  "detailed_analysis": {
    "financial_details": {
      "scores": {...},
      "details": {...}
    },
    "valuation_details": {
      "scores": {...},
      "details": {...}
    }
  },
  "data_sources": ["Financial Modeling Prep", "SERP API", "Google Gemini"],
  "evaluation_timestamp": "2024-01-15T10:30:00Z"
}</code></pre>
                </div>

                <!-- Health Check Endpoint -->
                <div class="mb-4">
                    <h6 class="text-primary">GET /health</h6>
                    <p class="text-muted">Check the health status of the API.</p>
                    
                    <h6>Response:</h6>
                    <pre><code>{
  "status": "healthy",
  "api": "connected",
  "timestamp": "2024-01-15T10:30:00Z"
}</code></pre>
                </div>
            </div>
        </div>

        <!-- Error Codes -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Error Codes
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-danger">400 - Bad Request</h6>
                        <p class="small text-muted">Invalid request parameters or missing required fields.</p>
                        
                        <h6 class="text-danger">401 - Unauthorized</h6>
                        <p class="small text-muted">Invalid or missing API keys.</p>
                        
                        <h6 class="text-danger">404 - Not Found</h6>
                        <p class="small text-muted">Stock ticker not found or invalid.</p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-danger">429 - Too Many Requests</h6>
                        <p class="small text-muted">Rate limit exceeded. Try again later.</p>
                        
                        <h6 class="text-danger">500 - Internal Server Error</h6>
                        <p class="small text-muted">Server error. Please try again.</p>
                        
                        <h6 class="text-danger">503 - Service Unavailable</h6>
                        <p class="small text-muted">External API service unavailable.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Code Examples -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-code me-2"></i>
                    Code Examples
                </h5>
            </div>
            <div class="card-body">
                <!-- Python Example -->
                <div class="mb-4">
                    <h6 class="text-primary">Python</h6>
                    <pre><code>import requests

url = "https://your-app-domain.com/api/evaluate"
headers = {
    "Content-Type": "application/json"
}
data = {
    "ticker": "AAPL",
    "fmp_api_key": "your_fmp_api_key",
    "serp_api_key": "your_serp_api_key",
    "gemini_api_key": "your_gemini_api_key",
    "include_detailed_analysis": True
}

response = requests.post(url, json=data, headers=headers)
result = response.json()
print(f"Score: {result['composite_score']}")
print(f"Verdict: {result['verdict']}")</code></pre>
                </div>

                <!-- JavaScript Example -->
                <div class="mb-4">
                    <h6 class="text-primary">JavaScript</h6>
                    <pre><code>const response = await fetch('https://your-app-domain.com/api/evaluate', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        ticker: 'AAPL',
        fmp_api_key: 'your_fmp_api_key',
        serp_api_key: 'your_serp_api_key',
        gemini_api_key: 'your_gemini_api_key',
        include_detailed_analysis: true
    })
});

const result = await response.json();
console.log(`Score: ${result.composite_score}`);
console.log(`Verdict: ${result.verdict}`);</code></pre>
                </div>

                <!-- cURL Example -->
                <div class="mb-4">
                    <h6 class="text-primary">cURL</h6>
                    <pre><code>curl -X POST https://your-app-domain.com/api/evaluate \
  -H "Content-Type: application/json" \
  -d '{
    "ticker": "AAPL",
    "fmp_api_key": "your_fmp_api_key",
    "serp_api_key": "your_serp_api_key",
    "gemini_api_key": "your_gemini_api_key",
    "include_detailed_analysis": true
  }'</code></pre>
                </div>
            </div>
        </div>

        <!-- Rate Limiting -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-tachometer-alt me-2"></i>
                    Rate Limiting
                </h5>
            </div>
            <div class="card-body">
                <p>
                    To ensure fair usage and prevent abuse, the API implements rate limiting:
                </p>
                <ul>
                    <li><strong>5 requests per minute</strong> per IP address</li>
                    <li><strong>200 requests per day</strong> per IP address</li>
                    <li>Rate limit headers are included in responses</li>
                </ul>
                <p class="text-muted small">
                    When rate limited, you'll receive a 429 status code. Wait for the reset time before making new requests.
                </p>
            </div>
        </div>

        <!-- Support -->
        <div class="text-center">
            <h5 class="mb-3">Need Help?</h5>
            <p class="text-muted mb-4">
                If you have questions about the API or need assistance with integration, 
                please check the documentation or contact support.
            </p>
            <a href="{{ url_for('evaluate') }}" class="btn btn-primary">
                <i class="fas fa-play me-2"></i>
                Try the Web Interface
            </a>
        </div>
    </div>
</div>
{% endblock %} 